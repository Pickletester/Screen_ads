<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=845, height=314, initial-scale=1.0">
    <title>Novastar Player (Debug Mode)</title>
    <style>
        body, html { margin: 0; padding: 0; background-color: #000; width: 845px; height: 314px; overflow: hidden; font-family: sans-serif; }
        #container { width: 845px; height: 314px; display: flex; justify-content: center; align-items: center; position: relative; }
        img, video { width: 100%; height: 100%; object-fit: fill; display: none; }
        .active { display: block; }
        
        /* Debug Console Styles */
        #debug {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(50, 0, 0, 0.9); color: #fff; z-index: 999;
            padding: 20px; box-sizing: border-box; font-size: 18px;
            white-space: pre-wrap; overflow-y: auto; display: none;
        }
    </style>
</head>
<body>

    <div id="container">
        <div id="debug">Initializing Player...</div>
        </div>

    <script>
        const container = document.getElementById('container');
        const debugScreen = document.getElementById('debug');
        let playlist = [];
        let currentIndex = 0;

        // LOGGING FUNCTION (Prints errors to the screen)
        function log(msg, isError = false) {
            console.log(msg);
            if (isError) {
                debugScreen.style.display = 'block'; // Show red screen
                debugScreen.innerHTML += `<span style="color:${isError ? '#ff4444' : '#fff'}">${msg}</span><br>`;
            }
        }

        async function loadPlaylist() {
            try {
                // Fetch playlist with timestamp to bust cache
                const response = await fetch('playlist.json?t=' + new Date().getTime());
                
                if (!response.ok) {
                    throw new Error(`Could not find playlist.json (Status: ${response.status})`);
                }

                const text = await response.text();
                try {
                    playlist = JSON.parse(text);
                } catch (e) {
                    throw new Error("JSON Syntax Error: You likely missed a comma or have an extra one in playlist.json.");
                }

                if (playlist.length === 0) {
                    log("Playlist is empty!", true);
                    return;
                }

                // Hide debug screen if successful
                debugScreen.style.display = 'none';
                debugScreen.innerHTML = ''; 
                playContent();

            } catch (error) {
                log("CRITICAL ERROR: " + error.message, true);
                setTimeout(loadPlaylist, 5000); // Retry
            }
        }

        function playContent() {
            if (currentIndex >= playlist.length) {
                currentIndex = 0;
                loadPlaylist();
                return;
            }

            const item = playlist[currentIndex];
            
            // Remove old content but keep debug layer
            Array.from(container.children).forEach(child => {
                if (child.id !== 'debug') container.removeChild(child);
            });

            if (item.type === 'image') {
                const img = document.createElement('img');
                img.onload = () => {
                    img.classList.add('active');
                    setTimeout(() => { currentIndex++; playContent(); }, item.duration * 1000);
                };
                img.onerror = () => {
                    log(`ERROR: Could not load image: ${item.url}. Check spelling and capitalization!`, true);
                    setTimeout(() => { currentIndex++; playContent(); }, 3000); // Skip after 3s
                };
                img.src = item.url;
                container.appendChild(img);

            } else if (item.type === 'video') {
                const vid = document.createElement('video');
                vid.muted = true;
                vid.autoplay = true;
                vid.playsInline = true;
                
                vid.onended = () => { currentIndex++; playContent(); };
                vid.onerror = (e) => {
                    log(`ERROR: Could not load video: ${item.url}. Check spelling!`, true);
                    setTimeout(() => { currentIndex++; playContent(); }, 3000);
                };

                vid.src = item.url;
                vid.classList.add('active');
                container.appendChild(vid);
            }
        }

        loadPlaylist();
    </script>
</body>
</html>
