<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=845, height=314, initial-scale=1.0">
    <title>Novastar Player (Broadcast Sync)</title>
    <style>
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; }
        #container { width: 845px; height: 314px; position: relative; }
        img, video { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; object-fit: fill; }
        .active { display: block; }
    </style>
</head>
<body>

    <div id="container">
        </div>

    <script>
        // --- YOUR PLAYLIST ---
        // IMPORTANT: Set the actual duration for the video!
        var myAds = [
            { type: 'image', url: 'Applebox.jpg', duration: 10 },
            { type: 'image', url: 'Comcast.jpg', duration: 10 },
            { type: 'image', url: 'Feet_DR.jpg', duration: 10 }, 
            { type: 'image', url: 'Howard_Hannah.jpg', duration: 10 },
            { type: 'image', url: 'Itaily.jpg', duration: 10 },
            { type: 'image', url: 'J_Frances2.jpg', duration: 10 },
            { type: 'image', url: 'Lorenzi.jpg', duration: 10 },
            { type: 'image', url: 'Mission.jpg', duration: 10 },
            { type: 'image', url: 'Pickleball_lifeline.jpg', duration: 10 },
            { type: 'image', url: 'Sun_Chevy.jpg', duration: 10 },
            { type: 'image', url: 'ad1.jpg', duration: 10 },
            
            // CHANGE "15" BELOW TO THE EXACT LENGTH OF YOUR VIDEO
            { type: 'video', url: 'Screen_2_1.mp4', duration: 15 } 
        ];

        var container = document.getElementById('container');
        var currentIndex = 0;

        // 1. CALCULATE START TIME BASED ON CLOCK
        function getSyncedStartIndex() {
            var totalLoopTime = 0;
            
            // Calculate total playlist length
            myAds.forEach(item => {
                // Safety: Treat 0 duration as 10s to prevent crash
                if (!item.duration || item.duration <= 0) item.duration = 10;
                totalLoopTime += item.duration;
            });

            // Get current time in seconds
            var now = Math.floor(Date.now() / 1000);
            
            // Find where we are in the loop (Modulo)
            var timeIntoLoop = now % totalLoopTime;
            
            var accumulatedTime = 0;
            for (var i = 0; i < myAds.length; i++) {
                var itemDuration = myAds[i].duration;
                
                // If the current time falls inside this item's window
                if (timeIntoLoop < accumulatedTime + itemDuration) {
                    // Return the index and how much time is remaining for this specific ad
                    return { 
                        index: i, 
                        remaining: (accumulatedTime + itemDuration) - timeIntoLoop 
                    };
                }
                accumulatedTime += itemDuration;
            }
            return { index: 0, remaining: myAds[0].duration };
        }

        function playNext(firstRun = false, overrideDuration = null) {
            var item = myAds[currentIndex];
            
            // Clear screen
            container.innerHTML = '';

            var durationToPlay = overrideDuration || item.duration;

            if (item.type === 'image') {
                var img = document.createElement('img');
                img.src = item.url;
                img.className = 'active';
                container.appendChild(img);

                setTimeout(function() {
                    currentIndex++;
                    if (currentIndex >= myAds.length) currentIndex = 0;
                    playNext();
                }, durationToPlay * 1000);
            } 
            else if (item.type === 'video') {
                var vid = document.createElement('video');
                vid.src = item.url;
                vid.className = 'active';
                vid.muted = true;
                vid.autoplay = true;
                vid.playsInline = true;
                
                // If we jumped into the middle of a video, try to seek (optional)
                if (firstRun && overrideDuration) {
                   vid.currentTime = item.duration - overrideDuration;
                }

                // Fallback: Just play to end
                vid.onended = function() {
                    currentIndex++;
                    if (currentIndex >= myAds.length) currentIndex = 0;
                    playNext();
                };
                
                vid.onerror = function() {
                    currentIndex++;
                    if (currentIndex >= myAds.length) currentIndex = 0;
                    playNext();
                };
                
                container.appendChild(vid);
            }
        }

        // Start the engine
        var startData = getSyncedStartIndex();
        currentIndex = startData.index;
        
        // Log for testing
        console.log("Syncing to TV Mode... Starting at Index: " + currentIndex);
        
        // Start playing with the calculated remaining time for the first item
        playNext(true, startData.remaining);

    </script>
</body>
</html>
